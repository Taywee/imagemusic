import init, { song_from_toml, song_free, song_samples } from './pkg/imagemusic.js';

const bloody_tears = `
ticks_per_second = 400.0

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "160r0 160des4 160fes4 160r0 160des4 160fes4 160r0 160des4 160fes4 160r0 160des4 160fes4 160r0 160des4
160fes4 160r0 160des4 160fes4 160r0 160des4 160fes4 160r0 160des4 160fes4 160a3 160des4 160fes4 160a3 160des4 1
60fes4 320a3 160ges4 160a3 160d4 160ges4 160r0 160c4 160ges4 160r0 160des4 160fes4 160r0 160des4 160es4 160r0 1
60c4 160es4 960r0 480r0 240r0 120r0 120as4 1440as4 480as4 960as4 960a4 960as4 480ges4 480ces5 320fes4 160fes4 1
60r0 160ces4 160fes4 160r0 160ces4 160fes4 160r0 160ces4 160fes4 960r0 480r0 240r0 120r0 120g4 1440g4 480g4 144
0g4 480ges4 960ges4 480g4 480fes4 960ges4 960ges4 960r0 480r0 480ces5 1440c5 480r0 160ces4 160es4 160ges4 960r0
 160ces4 160es4 160ges4 1440c5 480r0 960r0 960ces5 960ces5 960r0 960g4 960ges4 960des4 960r0 960r0 480r0 360des
5 120des5 480r0 160des4 160as4 160ces5 480r0 360des5 120des5 480r0 160r0 160ges4 160a4 480c5 480des5 1440es5 48
0r0 960r0 480es5 480r0 480c5 480as4 480a4 480ges4 960r0 480a3 480r0 480r0 480des5 480fes5 480des5 480r0 480des4
 480fes4 480des4 160r0 160a3 160r0 160c4 160a3 160es4 160c4 160ges4 160es4 160a4 160ges4 160c5 160r0 160des4 16
0r0 160fes4 160des4 160as4 160fes4 160des5 160as4 160fes5 160des5 160as4 160des4 160g4 160fes4 160bes4 160g4 16
0des5 160bes4 160fes5 160des5 160g5 160fes5 160bes5 160ges4 160c5 160a4 160es5 160c5 160ges5 160es5 160a5 160ge
s5 160c6 160a5 160es6 160c6 160ges5 160a5 160es5 160ges5 160c5 160es5 160a4 160c5 160ges4 160a4 160es4 160ges4
160c4 160es4 160a3 160c4 160r0 480a3 320r0 160a3 480r0 480a3 320r0 160a3 320r0 160a3 480r0 480a3 320r0 160a3 32
0r0 160a3 480r0 480a3 320r0 160des4 320r0 160des4 160r0 160a3 160des4 160r0 160a3 160des4 320r0 160c4 320r0 160
c4 960r0 480r0 240r0 120r0 120as4 1440as4 480as4 960as4 960a4 960r0 480r0 480ces5 960r0 480r0 360ces5 120ces5 1
60ces4 160ges4 160a4 960r0 160ces4 160ges4 160a4 480r0 160ces4 160fes4 160as4 480c5 480des5 160es4 160ges4 160a
s4 480r0 160fes4 160as4 160des5 480r0 160d4 160ges4 160a4 480r0 160c4 160ges4 160as4 480r0 160des4 160fes4 160a
s4 960r0 160des4 160f4 160as4 1440d5 480r0 160des4 160f4 160as4 960r0 160des4 160f4 160as4 1440d5 480r0 160des4
 160f4 160as4 480r0 160des4 160ges4 160a4 480r0 480r0 160ces4 160ges4 160a4 160ces4 160ges4 160a4 480ces5 480a4
 480a4 480as4 480as4 960ges4 480as4 480a4 960as4 480as4 480r0 320des4 160des4 160r0 160des4 160fes4 160r0 160de
s4 160fes4 160r0 160des4 160fes4 160r0 160es4 160ges4 160r0 160es4 160ges4 160r0 160es4 160ges4 160r0 160es4 16
0ges4 160r0 160fes4 160des4 160as4 160fes4 160des5 160as4 160fes5 160des5 160as5 160fes5 160des5 160c5 160es5 1
60a4 160c5 160ges4 160a4 160es4 160ges4 160a3 480c4 160des4 160fes4 160des4 160as4 160fes4 160des5 160as4 160fe
s5 160des5 160as5 160fes5 160des5 160c5 160es5 160a4 160c5 160ges4 160a4 160es4 160ges4 160a3 480c4 320des4 160
des4 160fes4 160des4 160r0 480r0 480des4 1920r0 960r0 960des4 1920des4"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "4960r0 160d4 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0
 160r0 960r0 480r0 240r0 120r0 120r0 1440r0 480r0 960r0 960r0 960r0 480r0 480r0 160r0 160ces4 160r0 160r0 160r0
 160r0 160r0 160r0 160r0 160r0 160r0 160r0 960r0 480r0 240r0 120r0 120r0 1440r0 480r0 1440r0 480r0 960r0 480r0
480r0 960r0 960r0 960r0 480r0 480r0 1440r0 480r0 1440ces5 160r0 160r0 160r0 1440r0 480r0 960r0 960r0 960r0 960r
0 960r0 960r0 960r0 960r0 960r0 480r0 360r0 120r0 480r0 160r0 160r0 160r0 480r0 360r0 120r0 480r0 160r0 160r0 1
60r0 480r0 480r0 1440r0 480r0 960r0 480r0 480r0 480r0 480r0 480r0 480r0 960r0 480r0 480r0 480r0 480r0 480r0 480
r0 480r0 480r0 480r0 480r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0
160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160
r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0
160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 320r0 160r0 480
r0 480r0 320r0 160r0 320r0 160r0 480r0 480r0 320r0 160r0 320r0 160r0 480r0 480r0 320r0 160r0 320r0 160r0 160r0
160r0 160r0 160r0 160r0 160r0 320r0 160r0 320r0 160r0 960r0 480r0 240r0 120r0 120r0 1440r0 480r0 960r0 960r0 96
0r0 480r0 480r0 960r0 480r0 360r0 120r0 1440ces5 160r0 160r0 160r0 480r0 160r0 160r0 160r0 480r0 480r0 960es5 9
60fes5 960d5 960c5 1440des5 160r0 160r0 160r0 1440r0 480r0 1440des5 160r0 160r0 160r0 1440r0 480r0 960des5 960d
es5 480r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 480r0 480r0 480r0 480r0 960r0 480r0 480r0 960r0 480r0 480r0
 320r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 16
0r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0
 160r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 16
0r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 320r0 160r0 160r0 160r0 160r0 480r0 480r0
 1920r0 960r0 960r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "1408r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920
r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 192
0r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 19
20r0 1920r0 1920r0 1920r0 1920r0 1920r0 960r0 480a3 480r0 1920r0 960r0 480a3 480r0 1920r0 1920r0 1920r0 1920r0
1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "2816r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920
r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 192
0r0 1920as1 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1
920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0
1920r0 1920r0 1920r0 1920r0 3840des2 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "62080r0 960as2 960r0 1920r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "4224r0 1920r0 1920r0 1920r0 1920r0 960r0 480r0 480as4 960r0 120r0 240es4 120ges4 240r0 120r0 120as4 13
7r0 206des4 137fes4 69r0 69r0 206des4 137fes4 137a3 206des4 137ges4 137a3 206des4 137ges4 137r0 206ces4 137fes4
 69r0 69r0 206ces4 137fes4 171a3 137ces4 137es4 34a3 160r0 160ces4 160es4 1920r0 960r0 480r0 480g4 960r0 120r0
240ces4 120f4 240r0 120r0 120g4 960r0 120r0 240des4 120fes4 480r0 137r0 206ces4 137d4 69r0 69r0 206ces4 137d4 1
60r0 160ces4 160des4 160r0 160ces4 160des4 137r0 206ces4 137d4 69r0 69r0 206ces4 137d4 137r0 206bes3 137des4 69
r0 69r0 206bes3 137des4 160ces4 160d4 160ges4 160ces4 160d4 160ges4 160ces4 160es4 160ges4 160ces4 160es4 160ge
s4 480ces4 160r0 160fes4 160g4 160ces4 160fes4 160g4 480bes4 480r0 160ces4 160es4 160ges4 160ces4 160es4 160ges
4 480ces5 160r0 160fes4 160g4 480r0 480r0 160ces4 160fes4 160g4 160ces4 160es4 160ges4 480r0 160ces4 160d4 160f
4 480r0 160ces4 160des4 160as4 480r0 160a3 160des4 160ges4 480r0 137r0 206ces4 137d4 69r0 69r0 206ces4 137d4 13
7r0 206a3 137es4 69r0 69r0 206a3 137es4 320r0 160a3 480r0 480des4 480des4 160r0 160a3 160des4 160a3 160des4 160
ges4 160des4 160ges4 160a4 160des4 160ges4 160a4 160des4 160as4 160ces5 480r0 160des4 160as4 160ces5 160des4 16
0as4 160ces5 160des4 160ges4 160a4 480r0 160c4 160ges4 160a4 160des4 160ges4 160a4 480r0 160es4 160ges4 160as4
160es4 160ges4 160as4 480es5 160fes4 160as4 160des5 960r0 160des4 160fes4 160bes4 160r0 160c4 160es4 160r0 160c
4 160es4 160r0 160c4 160es4 160r0 160c4 160es4 1920r0 160r0 160fes4 160as4 160r0 160fes4 160as4 160r0 160fes4 1
60as4 160r0 160fes4 160as4 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 320r0 1
60des4 160r0 160des4 160fes4 160r0 160des4 160fes4 320as4 160fes4 960r0 120r0 240es4 120ges4 240r0 120r0 120as4
 137r0 206des4 137fes4 69r0 69r0 206des4 137fes4 137a3 206des4 137ges4 137a3 206des4 137ges4 960as4 480ges4 480
a3 320fes4 160fes4 160ces4 160fes4 160as4 160ces4 160fes4 160as4 160ces4 160fes4 160as4 480r0 160ces4 160ges4 1
60a4 160ces4 160ges4 160a4 360ces5 120ces5 160ces4 160fes4 160as4 480r0 160c4 160ges4 160as4 160des4 160fes4 16
0as4 480r0 160es4 160ges4 160as4 480r0 160fes4 160as4 160des5 480r0 160d4 160ges4 160a4 480r0 160c4 160ges4 160
as4 480r0 160des4 160fes4 160as4 160des4 160f4 160as4 480des5 160r0 160ges4 160a4 480r0 480r0 160des4 160ges4 1
60a4 480r0 160des4 160f4 160as4 160des4 160f4 160as4 480des5 160r0 160ges4 160a4 480r0 480r0 160des4 160ges4 16
0a4 480r0 160des4 160f4 160as4 480r0 160des4 160ges4 160a4 160ces4 160ges4 160a4 960r0 160ces4 160fes4 160as4 1
60a3 160fes4 160as4 160a3 160es4 160ges4 160r0 160es4 160ges4 160r0 160des4 160fes4 137r0 206des4 137es4 69r0 6
9r0 206des4 137es4 160r0 160des4 160es4 160a3 160des4 160es4 137r0 206des4 137fes4 69r0 69r0 206des4 137fes4 16
0r0 160c4 160es4 160r0 160c4 160es4 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "38788r0 960ces5 160r0 160r0 160r0 480r0 160r0 160r0 160r0 480r0 960a4 137r0 206r0 137r0 69r0 69r0 206r
0 137r0 137r0 206r0 137r0 69r0 69r0 206r0 137r0 320r0 160r0 480r0 480r0 480r0 160r0 160r0 160r0 160r0 160r0 160
r0 160r0 160r0 160r0 160r0 160r0 160r0 960des5 160r0 160r0 160r0 160r0 160r0 160r0 960des5 160r0 160r0 160r0 16
0r0 160r0 160r0 480r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 1440fes5 160r0 160r0 160r0 160r0 160r0 160r0 16
0r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 1920r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r
0 160r0 160r0 160r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 320r0 160r0 16
0r0 160r0 160r0 160r0 160r0 160r0 160r0 160des4 160r0 960r0 120r0 240r0 120r0 240r0 120r0 120r0 137r0 206r0 137
r0 69r0 69r0 206r0 137r0 137r0 206r0 137r0 137r0 206r0 137r0 960r0 480r0 480r0 160r0 160ces4 160r0 160r0 160r0
160r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 160r0 160r0 160r0 160r0 160r0 160r0 360r0 120r0 960ces5 160r0 1
60r0 160r0 160r0 160r0 160r0 480r0 160r0 160r0 160r0 480r0 160r0 160r0 160r0 480r0 160r0 160r0 160r0 480r0 160r
0 160r0 160r0 480r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 160r0 160r0 160r0 480r0 480r0 160r0 160r0 160r0 4
80r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 160r0 160r0 160r0 480r0 480r0 160r0 160r0 160r0 480r0 160r0 160r
0 160r0 480r0 160r0 160r0 160r0 1440ces5 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r
0 160r0 160r0 160r0 137r0 206r0 137r0 69r0 69r0 206r0 137r0 160r0 160r0 160r0 160r0 160r0 160r0 137r0 206r0 137
r0 69r0 69r0 206r0 137r0 160r0 160r0 160r0 160r0 160r0 160r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1
920r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "5641r0 1920r0 1920r0 1920r0 1920r0 320r0 160des4 160r0 160des4 160fes4 160r0 160des4 160fes4 160r0 160
des4 160fes4 137r0 206es4 137ges4 69r0 69r0 206es4 137ges4 480r0 160r0 160es4 160ges4 1920r0 1920r0 1920r0 160r
0 160ces4 160fes4 160r0 160ces4 160fes4 160r0 160ces4 160fes4 160r0 160ces4 160fes4 137r0 206ces4 137f4 69r0 69
r0 206ces4 137f4 480r0 160r0 160ces4 160f4 137r0 206c4 137fes4 69r0 69r0 206ces4 137fes4 480r0 160r0 160des4 16
0fes4 1920r0 1920r0 1920r0 160r0 160fes4 160g4 480ces4 480r0 160ces4 160fes4 160g4 1920r0 480ces4 160ces4 160fe
s4 160g4 160ces4 160fes4 160g4 480bes4 480r0 160ces4 160es4 160ges4 480r0 160ces4 160d4 160f4 480r0 160ces4 160
des4 160as4 480r0 160a3 160des4 160ges4 1920r0 480r0 240r0 120r0 120a3 960r0 1920r0 1920r0 480r0 480des4 960r0
160es4 160ges4 160as4 480r0 480r0 160es4 160ges4 160as4 480r0 160fes4 160as4 160des5 160es4 160ges4 160a4 480de
s5 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 137
r0 206es4 137ges4 69r0 69r0 206es4 137ges4 480r0 160r0 160es4 160ges4 1920r0 137r0 206ces4 137fes4 69r0 69r0 20
6ces4 137fes4 160a3 160ces4 160es4 160r0 160ces4 160es4 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 480des4 160de
s4 160ges4 160a4 160des4 160ges4 160a4 480c5 1920r0 480des4 160des4 160ges4 160a4 160des4 160ges4 160a4 480c5 1
920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "7054r0 480as3 480r0 960r0 480as3 480r0 960r0 960a1 960ges1 480as3 480r0 960r0 480r0 480as3 480as3 480a
s3 480as3 480as3 480as3 480as3 480as3 480as3 960ges1 480as3 480as3 960ces2 480as3 480as3 480as3 480as3 480g3 48
0g3 480g3 480g3 480g3 480g3 480g3 480g3 480c2 480ces2 480g3 480ges3 480ges3 480ges3 480fes2 480g2 480ges3 480ge
s3 480ges3 480ges3 2400ces2 480fes2 480g2 480fes2 2400ces2 480fes2 480g2 480fes2 960ces2 960as1 960f1 960ges1 4
80g3 480g3 480ges3 480ges3 160des3 160ges3 160r0 160des3 320ges3 160des3 160ges3 160as3 160des2 160f3 160as3 48
0ges3 480r0 960r0 1920f2 960ges2 480es2 480des2 1440c2 480c2 960des2 480ges1 480g1 1920as1 160r0 160c3 160es3 4
80as3 480r0 480ges3 480fes3 480r0 960r0 640r0 320fes3 320r0 640as3 160es3 160r0 160ges3 480r0 960r0 160fes3 160
r0 160as3 480r0 960r0 1920as1 1920r0 1920r0 480r0 320r0 160ges3 160r0 320es3 320des3 160r0 137r0 206ges3 137as3
 69r0 69r0 206as3 137ges3 480es3 480des3 137r0 206ges3 137as3 69r0 69r0 206as3 137ges3 480d3 480des3 137r0 206g
es3 137as3 69r0 69r0 206as3 137ges3 160r0 160fes3 160r0 480r0 480es3 480es3 160es3 160as3 160r0 160es3 320ges3
480r0 480as3 480as3 480as3 480as3 480r0 960r0 480as3 480r0 960r0 480as3 480r0 960r0 480as3 480r0 960r0 1920es2
960fes2 480es2 480des2 960c2 480des2 480r0 960ges1 960as1 2400des2 480ges2 480a2 480ges2 2400des2 480ges2 480a2
 480ges2 960des2 960ges1 1440es2 480fes2 480des2 480es2 480c2 480des2 480ges3 480r0 960r0 960as1 480ges3 480ges
3 160fes3 160as3 160r0 480r0 960r0 480as3 480as3 480as3 360as2 120as2 480as3 480r0 480r0 360as2 120as2 1440as1
160r0 160as3 160ges3 480fes3 480r0 480r0 360as2 120as2 1440as1 160r0 160as3 160ges3 960r0 480r0 120r0 240as3 12
0fes3 1920r0 960des2 960des2 1920des2"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "10894r0 960a2 960ges2 480r0 480r0 960r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 96
0ges2 480r0 480r0 960ces3 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480c3 480ces3
 480r0 480r0 480r0 480r0 480g3 480fes3 480r0 480r0 480r0 480r0 2400ces3 480fes3 480g3 480fes3 2400ces3 480fes3
480g3 480fes3 960ces3 960as2 960f2 960ges2 480r0 480r0 480r0 480r0 160r0 160r0 160r0 160r0 320r0 160r0 160r0 16
0r0 160des3 160r0 160r0 480r0 480r0 960r0 1920des3 960ges3 480es3 480des3 1440as2 480as2 960as2 480ges2 480g2 1
920as2 160r0 160r0 160r0 480r0 480r0 480r0 480r0 480r0 960r0 640r0 320r0 320r0 640r0 160r0 160r0 160r0 480r0 96
0r0 160r0 160r0 160r0 480r0 960r0 1920as2 1920r0 1920r0 480r0 320r0 160r0 160r0 160r0 160ges3 160r0 160ges3 160
r0 137r0 206r0 137r0 69r0 69r0 206r0 137r0 480r0 480r0 137r0 206r0 137r0 69r0 69r0 206r0 137r0 480r0 480r0 137r
0 206r0 137r0 69r0 69r0 206r0 137r0 160r0 160r0 160r0 480r0 480r0 480r0 160r0 160r0 160r0 160r0 320r0 480r0 480
r0 480r0 480r0 480r0 480r0 960r0 480r0 480r0 960r0 480r0 480r0 960r0 480r0 480r0 960r0 1920es3 960fes3 480es3 4
80des3 960as2 480as2 480r0 960ges2 960as2 2400des3 480ges3 480r0 480ges3 2400des3 480ges3 480r0 480ges3 960des3
 960ges2 1440es3 480fes3 480des3 480es3 480c3 480des3 480r0 480r0 960r0 960as2 480r0 480r0 160r0 160r0 160r0 48
0r0 960r0 480r0 480r0 480r0 360as3 120r0 480r0 480r0 480r0 360r0 120r0 1440as2 160r0 160r0 160r0 480r0 480r0 48
0r0 360r0 120r0 1440as2 160r0 160r0 160r0 960r0 480r0 120r0 240r0 120r0 1920r0 960r0 960as2 1920as2"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "28174r0 480g3 480g3 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 480r0 1920r0 480r0 480r0 480
r0 480r0 1920r0 480r0 480r0 480r0 480r0 960r0 960r0 960r0 960r0 480r0 480r0 480r0 480r0 160r0 160r0 160r0 160r0
 320r0 160r0 160r0 160r0 160r0 160r0 160r0 480r0 480r0 960r0 1920f3 960r0 480r0 480r0 1440c3 480c3 960des3 480r
0 480r0 1920r0 160r0 160r0 160r0 480r0 480r0 480r0 480r0 480r0 960r0 640r0 320r0 320r0 640r0 160r0 160r0 160r0
480r0 960r0 160r0 160r0 160r0 480r0 960r0 1920r0 1920r0 1920r0 480r0 320r0 160r0 160r0 160r0 160r0 160r0 160r0
160r0 137r0 206r0 137r0 69r0 69r0 206r0 137r0 480r0 480r0 137r0 206r0 137r0 69r0 69r0 206r0 137r0 480r0 480r0 1
37r0 206r0 137r0 69r0 69r0 206r0 137r0 160r0 160r0 160r0 480r0 480r0 480r0 160r0 160r0 160r0 160r0 320r0 480r0
480r0 480r0 480r0 480r0 480r0 960r0 480r0 480r0 960r0 480r0 480r0 960r0 480r0 480r0 960r0 1920r0 960r0 480r0 48
0r0 960c3 480des3 480r0 960r0 960r0 1920r0 480r0 480r0 480r0 480r0 1920r0 480r0 480r0 480r0 480r0 960r0 960r0 1
440r0 480r0 480r0 480r0 480as3 480as3 480r0 480r0 960r0 480r0 480as3 480r0 480r0 160r0 160r0 160r0 480r0 960r0
480r0 480r0 480r0 360r0 120r0 480r0 480r0 480r0 360r0 120r0 1440r0 160r0 160r0 160r0 480r0 480r0 480r0 360r0 12
0r0 1440r0 160r0 160r0 160r0 960r0 480r0 120r0 240r0 120r0 1920r0 960r0 960des3 1920des3"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "5585r0 960fes3 1920fes3"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "5585r0 960as3 1920as3"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "8465r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920
r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920as1 19
20r0 1920as2 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920as1 1920as1 960as1 960a1 1920r0 1920des2 1920r0 1920
r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 192
0des2 1920r0 1920r0 960r0 480r0 480as2 1920r0 960r0 480r0 480as2 160fes3 160as3 160r0 480r0 960des3 160r0 160de
s3 160fes3 160as3 160fes3 160des3 160as2 160des3 160as2 160fes2 160as2 160fes2 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "62225r0 1920as2 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920as2 1920as2 960r0 960a2 19
20r0 1920as2 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0
1920r0 1920r0 1920r0 1440as2 480r0 1920r0 1920r0 960r0 480r0 480r0 1920r0 960r0 480r0 480r0 160r0 160r0 160r0 4
80r0 960r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "21649r0 1920des3 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1
920r0 1920r0 1920r0 1920r0 1920r0 1440r0 480r0 1920r0 1920r0 960r0 480r0 480r0 1920r0 960r0 480r0 480r0 160r0 1
60r0 160r0 480r0 960r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 160r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "9873r0 1920des2 1920ces2 1920r0 960as1 480as1 480ges3 1920des2 1920c2 960des2 960r0 960ces2 960r0 1920
fes2 1920fes2 1920d2 960r0 960bes1 960ces2 960r0 960ges2 960ges1 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 960c
es2 960c2 960des2 480des2 480r0 1920ges1 1920r0 1920r0 1920r0 1920r0 1920r0 480r0 160r0 160c3 160es3 120r0 240c
3 120es3 160r0 160c3 160es3 1920as1 137r0 137fes3 274as3 274r0 137as3 137r0 274fes3 274r0 137fes3 137as3 1920as
1 1920as1 1920r0 5760as1 960c3 120r0 360ges3 120r0 360ges3 960c3 120r0 360ges3 120r0 360ges3 960as2 480des3 120
des3 360fes3 960ges1 960as1 160fes3 160as3 160r0 480r0 960r0 1920c2 960des2 960ges1 960ces2 960ces2 1920fes2 19
20r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 960a1 480as1 480ges1 480as3 480r0 96
0as1 480r0 480as3 480as3 360as2 120as2 1920c2 1920des2 960r0 480r0 240r0 120r0 120as2 1440des2 480r0 960r0 480r
0 240r0 120r0 120as2 480r0 240r0 120r0 120as3 160r0 160fes3 160as3 480r0 480as2 480r0 960r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "9873r0 1920des3 1920ces3 1920r0 960as2 480as2 480r0 1920as2 1920as2 960des3 960r0 960ces3 960r0 1920fe
s3 1920fes3 1920d3 960r0 960bes2 960ces3 960r0 960r0 960ges2 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 960ces3
960c3 960r0 480r0 480r0 1920des2 1920r0 1920r0 1920r0 1920r0 1920r0 480r0 160r0 160r0 160r0 120r0 240r0 120r0 1
60r0 160r0 160r0 1920as2 137r0 137r0 274r0 274r0 137r0 137r0 274r0 274r0 137r0 137r0 1920as2 1920as2 1920r0 576
0as2 960r0 120r0 360r0 120r0 360r0 960r0 120r0 360r0 120r0 360r0 960c3 480r0 120r0 360r0 960ges2 960as2 160r0 1
60r0 160r0 480r0 960r0 1920as2 960des3 960ges2 960ces3 960ces3 1920fes3 1920r0 1920r0 1920r0 1920r0 1920r0 1920
r0 1920r0 1920r0 1920r0 1920r0 1920r0 960a2 480as2 480ges2 480r0 480r0 960as2 480r0 480r0 480r0 360as3 120r0 14
40as2 480r0 1440as2 480r0 960r0 480r0 240r0 120r0 120r0 1440as2 480r0 960r0 480r0 240r0 120r0 120r0 480r0 240r0
 120r0 120r0 160r0 160r0 160r0 480r0 480r0 480r0 960r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "10353r0 480as3 480as3 480as3 480r0 480as3 480as3 480as3 1920r0 480r0 480as3 480as3 480r0 1920des3 1920
c3 960r0 960r0 960r0 960r0 1920r0 1920r0 1920r0 960r0 960r0 960r0 960r0 960r0 960r0 1920r0 1920r0 1920r0 1920r0
 1920r0 1920r0 960r0 960r0 960r0 480r0 480r0 1920ges2 1920r0 1920r0 1920r0 1920r0 1920r0 480r0 160r0 160r0 160r
0 120r0 240r0 120r0 160r0 160r0 160r0 1920r0 137r0 137r0 274r0 274r0 137r0 137r0 274r0 274r0 137r0 137r0 1920r0
 1920r0 1920r0 1920r0 1920r0 1920r0 960r0 120r0 360r0 120r0 360r0 960r0 120r0 360r0 120r0 360r0 960r0 480r0 120
r0 360r0 960r0 960r0 160r0 160r0 160r0 480r0 960r0 1920c3 480r0 480as3 960r0 480r0 480as3 960r0 1920r0 1920r0 1
920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 480r0 480ges3 480as3 480r0 480r0 480r0 960
r0 480r0 480r0 480r0 360r0 120r0 1440r0 480r0 1440r0 480r0 960r0 480r0 240r0 120r0 120r0 1440r0 480r0 960r0 480
r0 240r0 120r0 120r0 480r0 240r0 120r0 120r0 160r0 160r0 160r0 480r0 480r0 480r0 960r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]

[[voice]]
volume = 255
instrument = "Sawtooth"
notes = "17553r0 160fes3 160as3 160r0 1440r0 1920r0 960r0 960r0 960r0 960r0 1920r0 1920r0 1920r0 960r0 960r0 96
0r0 960r0 960r0 960r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 960r0 960r0 960r0 480r0 480r0 1920r0 1920r0 192
0r0 1920r0 1920r0 1920r0 480r0 160r0 160r0 160r0 120r0 240r0 120r0 160r0 160r0 160r0 1920r0 137r0 137r0 274r0 2
74r0 137r0 137r0 274r0 274r0 137r0 137r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 960r0 120r0 360r0 120r0 360r
0 960r0 120r0 360r0 120r0 360r0 960r0 480r0 120r0 360r0 960r0 960r0 160r0 160r0 160r0 480r0 960r0 480r0 480as3
480as3 480as3 480r0 480r0 960r0 480r0 480r0 960r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r0 1920r
0 1920r0 1920r0 1920r0 480r0 480r0 480r0 480r0 480r0 480r0 960r0 480r0 480r0 480r0 360r0 120r0 1440r0 480r0 144
0r0 480r0 960r0 480r0 240r0 120r0 120r0 1440r0 480r0 960r0 480r0 240r0 120r0 120r0 480r0 240r0 120r0 120r0 160r
0 160r0 160r0 480r0 480r0 480r0 960r0 1920r0 1920r0"
envelope = [[0, 0], [5, 255], [-5, 204], [-1, 0]]
`;

async function run() {
    await init();

    const audioCtx = new window.AudioContext();

    const song = song_from_toml(bloody_tears);

    let max_amplitude: number = 0.0;
    const samples = song_samples(song, audioCtx.sampleRate);
    console.log('Analyzing samples');
    samples.forEach(sample => {
        let amplitude = Math.abs(sample);
        if (amplitude > max_amplitude) {
            max_amplitude = amplitude;
        }
    });
    console.log('Done analyzing samples');

    const myArrayBuffer = audioCtx.createBuffer(1, samples.length, audioCtx.sampleRate);
    const channel = myArrayBuffer.getChannelData(0);

    // Find the reciprocal so that we can get the samples through multiplication
    // instead of division
    const gain = 1.0 / max_amplitude;
    let i = 0;
    console.log('Filling buffer');
    samples.forEach(sample => {
        channel[i] = sample * gain;
        i += 1;
    });
    console.log('Filled buffer');

    song_free(song);

    const source = audioCtx.createBufferSource();
    source.buffer = myArrayBuffer;
    source.connect(audioCtx.destination);
    source.start();
}

run();
